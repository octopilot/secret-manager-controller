---
# SecretManagerConfig for IDAM Service - Production Environment
#
# This example configures the Secret Manager Controller to sync secrets
# from the IDAM microservice's production deployment configuration to
# Google Cloud Secret Manager.
#
# Prerequisites:
# 1. A Flux GitRepository resource named "pricewhisperer-manifests" in the "flux-system" namespace
# 2. The GitRepository should point to the PriceWhisperer repository
# 3. GCP project with Secret Manager API enabled
# 4. Service account with Secret Manager Admin role
#
# Directory structure expected:
# microservices/idam/deployment-configuration/profiles/prd/
#   ├── application.properties      # Non-sensitive config
#   └── application.secrets.env      # SOPS-encrypted secrets
#
# Secrets will be synced to GCP Secret Manager with names:
# - idam-prd-supabase-anon-key
# - idam-prd-jwt-secret
# - idam-prd-supabase-service-role-key
# - idam-prd-properties (all properties as JSON)

apiVersion: secret-management.microscaler.io/v1
kind: SecretManagerConfig
metadata:
  name: idam-prd-secrets
  namespace: pricewhisperer
spec:
  # Reference to the Flux GitRepository that contains the IDAM configuration
  gitRepository:
    name: pricewhisperer-manifests
    namespace: flux-system
  
  # GCP project ID where secrets will be stored
  gcpProjectId: pricewhisperer-prd
  
  # Environment/profile name to sync (must match directory name under profiles/)
  # This explicitly specifies which environment to process
  environment: prd
  
  # Base path in the Git repository (default: "microservices")
  basePath: microservices
  
  # Optional: Prefix for secret names in GCP Secret Manager
  # If not specified, defaults to the service name from the path
  secretPrefix: idam-prd


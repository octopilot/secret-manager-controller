---
# SecretManagerConfig for IDAM Service - Development Environment
#
# This example configures the Secret Manager Controller to sync secrets
# from the MyApp microservice's development deployment configuration to
# Google Cloud Secret Manager.
#
# Prerequisites:
# 1. A Flux GitRepository resource named "mysystem-manifests" in the "flux-system" namespace
# 2. The GitRepository should point to your application repository
# 3. GCP project with Secret Manager API enabled
# 4. Service account with Secret Manager Admin role
#
# Directory structure expected:
# microservices/myapp/deployment-configuration/profiles/dev/
#   ├── application.properties      # Non-sensitive config
#   └── application.secrets.env      # SOPS-encrypted secrets
#
# Secrets will be synced to GCP Secret Manager with names:
# - myapp-dev-database-url
# - myapp-dev-api-key
# - myapp-dev-jwt-secret
# - myapp-dev-properties (all properties as JSON)

apiVersion: secret-management.octopilot.io/v1beta1
kind: SecretManagerConfig
metadata:
  name: myapp-dev-secrets
  namespace: mysystem
spec:
  # Source reference - supports FluxCD GitRepository and ArgoCD Application
  # This example uses FluxCD GitRepository
  sourceRef:
    kind: GitRepository  # FluxCD GitRepository
    name: mysystem-manifests
    namespace: flux-system
  
  # Cloud provider configuration
  provider:
    type: gcp
    gcp:
      projectId: mysystem-dev
    # Optional: GCP authentication configuration
    # If not specified, defaults to Workload Identity (recommended for GKE)
    # For Workload Identity:
    # auth:
    #   authType: WorkloadIdentity
    #   serviceAccountEmail: secret-manager-controller@mysystem-dev.iam.gserviceaccount.com
  
  # Secrets sync configuration
  secrets:
    # Environment/profile name to sync (must match directory name under profiles/)
    # This explicitly specifies which environment to process
    environment: dev
    # Base path in the Git repository (optional)
    # If not specified, searches from repository root
    # Examples: "microservices", "services", "apps", or omit for root
    basePath: microservices
    # Optional: Prefix for secret names in GCP Secret Manager
    # If not specified, defaults to the service name from the path
    prefix: myapp-dev
    # Optional: Suffix for secret names in GCP Secret Manager
    # Matches kustomize-google-secret-manager suffix behavior for drop-in replacement
    # Example: "-prod", "-be-gcw1", etc.
    # suffix: -prod


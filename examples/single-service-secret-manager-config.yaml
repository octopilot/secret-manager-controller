---
# SecretManagerConfig for Single Service - Development Environment
#
# This example configures the Secret Manager Controller for a single service
# repository structure (not a monolith). The service configuration is at the
# repository root level.
#
# Prerequisites:
# 1. A Flux GitRepository resource named "my-service-repo" in the "flux-system" namespace
# 2. The GitRepository should point to your single service repository
# 3. GCP project with Secret Manager API enabled
# 4. Service account with Secret Manager Admin role
#
# Directory structure expected:
# deployment-configuration/
#   profiles/
#     dev/
#       ├── application.properties      # Non-sensitive config
#       └── application.secrets.env     # SOPS-encrypted secrets
#     prd/
#       ├── application.properties      # Non-sensitive config
#       └── application.secrets.env     # SOPS-encrypted secrets
#
# Secrets will be synced to GCP Secret Manager with names:
# - my-service-database-url
# - my-service-api-key
# - my-service-properties (all properties as JSON)
#
# Note: The profiles/ directory structure is Skaffold-compliant.
# See: https://skaffold.dev/

apiVersion: secret-management.microscaler.io/v1beta1
kind: SecretManagerConfig
metadata:
  name: my-service-secrets
  namespace: default
spec:
  # Source reference - supports FluxCD GitRepository and ArgoCD Application
  # This example uses FluxCD GitRepository
  sourceRef:
    kind: GitRepository  # FluxCD GitRepository (default, can be omitted)
    name: my-service-repo
    namespace: flux-system
  
  # GCP project ID where secrets will be stored
  gcpProjectId: my-gcp-project-dev
  
  # Environment/profile name to sync (must match directory name under profiles/)
  # Examples: "dev", "dev-cf", "prod-cf", "pp-cf", "staging"
  # This explicitly specifies which environment to process
  environment: dev
  
  # Base path (optional)
  # For single service at root: omit this field or use "."
  # For monolith: specify path like "microservices", "services", "apps"
  # If omitted, searches from repository root
  # basePath: "."  # Optional - can be omitted for root
  
  # Required for single service: specify the service name prefix
  # This will be used as the secret prefix in GCP Secret Manager
  secretPrefix: my-service


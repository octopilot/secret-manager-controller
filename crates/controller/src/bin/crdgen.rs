//! # CRD Generator
//!
//! Generates Kubernetes CustomResourceDefinition (CRD) YAML from Rust type definitions.
//!
//! This binary uses the `kube` crate's `CustomResourceExt` trait to generate
//! the CRD YAML for the `SecretManagerConfig` resource.
//!
//! ## Usage
//!
//! ```bash
//! # Generate CRD YAML
//! cargo run -p controller --bin crdgen > config/crd/secretmanagerconfig.yaml
//!
//! # Generate and apply directly
//! cargo run -p controller --bin crdgen | kubectl apply -f -
//! ```
//!
//! The generated CRD includes:
//! - OpenAPI schema validation
//! - Required fields
//! - Default values
//! - Status subresource

use controller::crd::SecretManagerConfig;
use kube::core::CustomResourceExt;

fn main() {
    // Generate CRD YAML
    let crd = SecretManagerConfig::crd();

    // Serialize to YAML
    match serde_yaml::to_string(&crd) {
        Ok(yaml) => {
            // Print header comments warning that this file should not be edited manually
            println!("# This file is auto-generated by crdgen");
            println!("# DO NOT EDIT THIS FILE MANUALLY");
            println!(
                "# If there are malformed YAML issues, fix them in the Rust code (src/crd/mod.rs)"
            );
            println!("# This file will be overwritten on every code update");
            println!("#");
            println!("---");
            print!("{yaml}");
        }
        Err(e) => {
            eprintln!("Failed to serialize CRD to YAML: {e}");
            std::process::exit(1);
        }
    }
}

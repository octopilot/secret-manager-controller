apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: microscaler-system

resources:
  - namespace.yaml
  - crd/secretmanagerconfig.yaml
  - rbac/serviceaccount.yaml
  - rbac/role.yaml
  - rbac/rolebinding.yaml
  - rbac/clusterrole.yaml
  - rbac/clusterrolebinding.yaml
  # Note: role-sops-secret.yaml and rolebinding-sops-secret.yaml were removed as redundant
  # They duplicated permissions already granted by role.yaml and rolebinding.yaml
  # Note: PVC is created during Kind cluster setup (not managed by Tilt to avoid deletion issues)
  # See scripts/setup_kind.py create_pvc() function
  # - storage/pvc.yaml
  - deployment/deployment.yaml
  - service/metrics-service.yaml

# Pact Mode Patch
# Adds environment variables to route cloud provider requests to Pact mock servers
# This enables testing without real cloud accounts
# 
# NOTE: This patch is DISABLED by default for production deployments.
# The controller should use real cloud provider APIs in production.
# 
# To enable Pact mode for testing/development, uncomment the patch below
# or use a kustomize overlay (see config/deployment/README.md)
#
# patches:
#   - path: deployment/pact-env-patch.yaml
#     target:
#       kind: Deployment
#       name: secret-manager-controller


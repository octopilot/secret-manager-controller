---
apiVersion: secret-management.microscaler.io/v1beta1
kind: SecretManagerConfig
metadata:
  name: test-sops-config-argocd-prod-azure
  namespace: prod
spec:
  # Source reference - points to the ArgoCD Application in the same namespace
  sourceRef:
    kind: Application  # ArgoCD Application (not GitRepository)
    name: secret-manager-prod  # Must match Application name in application.yaml
    namespace: prod
  
  # Secrets configuration
  secrets:
    # Environment name - must match the directory name under profiles/
    environment: prod
    
    # Optional: Base path within the repository
    # Leave empty for single-service structure
    # Set to "microservices" for monolith structure
    basePath: ""
    
    # Optional: Default service name (used if not found in directory structure)
    # defaultServiceName: "test-service"
    
    # Secret prefix for cloud provider
    prefix: "test-service-prod"
    
    # Optional: Suffix for secret names
    # suffix: "prod"
  
  # Config store routing (optional)
  # When enabled, application.properties routes to config stores instead of secrets
  configs:
    enabled: false
    # For AWS: routes to Parameter Store
    # For GCP: routes to Secret Manager (interim solution)
    # For Azure: routes to App Configuration
  
  # Cloud provider configuration
  provider:
    type: azure
    azure:
      vaultName: test-vault
      # Optional: Authentication configuration
      # auth:
      #   authType: ManagedIdentity
      #   clientId: your-client-id
  
  # Reconcile interval - how often to reconcile secrets between Git and cloud providers
  # Production environment: 5 minutes
  reconcileInterval: "5m"
  
  # Git source pull update interval
  # How often to check for updates from the ArgoCD Application source
  # Production environment: 5 minutes
  gitRepositoryPullInterval: "5m"


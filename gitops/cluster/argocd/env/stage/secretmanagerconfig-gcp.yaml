apiVersion: secret-management.octopilot.io/v1beta1
kind: SecretManagerConfig
metadata:
  name: test-sops-config-argocd-stage
  namespace: stage
spec:
  # Source reference - points to the ArgoCD Application in the same namespace
  sourceRef:
    kind: Application  # ArgoCD Application (not GitRepository)
    name: secret-manager-stage  # Must match Application name in application.yaml
    namespace: stage
  
  # Secrets configuration
  secrets:
    # Environment name - must match the directory name under profiles/
    environment: stage
    
    # Optional: Base path within the repository
    # Leave empty for single-service structure
    # Set to "microservices" for monolith structure
    basePath: ""
    
    # Optional: Default service name (used if not found in directory structure)
    # defaultServiceName: "test-service"
    
    # Secret prefix for cloud provider
    prefix: "test-service-stage"
    
    # Optional: Suffix for secret names
    # suffix: "stage"
  
  # Config store routing (optional)
  # When enabled, application.properties routes to config stores instead of secrets
  configs:
    enabled: false
    # For AWS: routes to Parameter Store
    # For GCP: routes to Secret Manager (interim solution)
    # For Azure: routes to App Configuration
  
  # Cloud provider configuration
  provider:
    type: gcp
    gcp:
      projectId: your-gcp-project-id
      location: us-central1
      # Optional: Workload Identity configuration
      # auth:
      #   authType: WorkloadIdentity
      #   serviceAccountEmail: secret-manager-controller@your-project.iam.gserviceaccount.com
  
  # Reconcile interval - how often to reconcile secrets between Git and cloud providers
  # Stage environment: 3 minutes
  reconcileInterval: "3m"
  
  # Git source pull update interval
  # How often to check for updates from the ArgoCD Application source
  # Stage environment: 3 minutes
  gitRepositoryPullInterval: "3m"

